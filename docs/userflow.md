# Userflow: 블로그 체험단 리뷰 시스템

## 1. 인플루언서 유저 플로우

### 1.1 회원가입 및 온보딩

#### 1.1.1 회원가입 시작
**입력**
- 사용자가 `/signup` 페이지 접근
- 이메일 주소 입력
- 비밀번호 입력 (최소 8자 이상)
- 비밀번호 확인 입력

**처리**
- 이메일 형식 유효성 검증
- 비밀번호 강도 확인 (최소 8자)
- 비밀번호 일치 여부 확인
- Supabase Auth를 통한 회원가입 처리
  - `supabase.auth.signUp()` 호출
  - `auth.users` 테이블에 사용자 생성
- 세션 생성 및 쿠키 설정

**출력**
- 성공 시: 역할 선택 단계로 이동
- 실패 시:
  - 이메일 중복: "이미 등록된 이메일입니다" 에러 메시지 표시
  - 이메일 형식 오류: "올바른 이메일 형식을 입력해주세요" 에러 메시지 표시
  - 비밀번호 불일치: "비밀번호가 일치하지 않습니다" 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**엣지케이스**
- 이메일 중복 가입 시도
- 비밀번호가 너무 약한 경우
- 네트워크 연결 실패
- Supabase 서비스 장애

---

#### 1.1.2 역할 선택
**입력**
- 회원가입 성공 후 자동으로 역할 선택 화면 표시
- 라디오 버튼으로 "인플루언서" 선택
- 다음 버튼 클릭

**처리**
- 선택한 역할 정보를 세션 또는 임시 상태에 저장
- 역할에 따른 리다이렉트 경로 결정

**출력**
- 인플루언서 선택 시: `/onboarding/influencer` 페이지로 리다이렉트
- 광고주 선택 시: `/onboarding/advertiser` 페이지로 리다이렉트
- 선택하지 않은 경우: "역할을 선택해주세요" 에러 메시지 표시

**엣지케이스**
- 역할 미선택 상태에서 다음 버튼 클릭
- 브라우저 뒤로가기로 회원가입 페이지로 재진입 시도

---

#### 1.1.3 인플루언서 정보 등록
**입력**
- `/onboarding/influencer` 페이지에서 폼 입력
- 공통 정보:
  - 이름 (텍스트)
  - 생년월일 (Date Picker)
  - 휴대폰번호 (텍스트, 숫자만)
- 인플루언서 정보:
  - SNS 채널명 (텍스트)
  - 채널 링크 (URL, 복수 입력 가능: Naver Blog, YouTube, Instagram, Threads)
  - 팔로워 수 (숫자)
- 제출 버튼 클릭

**처리**
- 입력 데이터 유효성 검증:
  - 이름: 필수, 2자 이상
  - 생년월일: 필수, 만 14세 이상
  - 휴대폰번호: 필수, 010-XXXX-XXXX 형식
  - SNS 채널명: 필수
  - 채널 링크: 필수, URL 형식
  - 팔로워 수: 필수, 양수
- Zod 스키마로 서버 사이드 검증
- `POST /api/influencers` API 호출
- `influencers` 테이블에 데이터 삽입:
  - `user_id`: 현재 로그인한 사용자 ID
  - `name`, `birth_date`, `phone`: 공통 정보
  - `channel_name`, `channel_link`, `followers_count`: 인플루언서 정보
  - `created_at`, `updated_at`: 자동 생성

**출력**
- 성공 시:
  - "인플루언서 정보가 등록되었습니다" 성공 메시지 표시
  - `/` (홈 페이지)로 리다이렉트
- 실패 시:
  - 유효성 검증 실패: 각 필드별 에러 메시지 표시 (예: "이름은 2자 이상이어야 합니다")
  - 중복 등록 시도: "이미 등록된 정보가 있습니다" 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- 사용자 프로필 등록 완료 플래그 설정
- 체험단 지원 기능 활성화

**엣지케이스**
- 이미 인플루언서 정보가 등록된 사용자가 재접근 시도: 홈으로 리다이렉트
- 필수 필드 미입력 상태에서 제출 시도
- 휴대폰번호 형식 오류 (숫자 외 문자 포함)
- URL 형식이 아닌 채널 링크 입력
- 팔로워 수에 음수 또는 문자 입력
- 네트워크 연결 끊김 상태에서 제출

---

### 1.2 체험단 탐색 및 지원

#### 1.2.1 체험단 리스트 조회
**입력**
- `/` (홈 페이지) 접근
- 선택적 필터 적용:
  - 카테고리 선택 (드롭다운)
  - 지역 선택 (드롭다운)
  - 모집 상태 선택 (모집중/모집종료/선정완료)
- 선택적 정렬 변경:
  - 최신순 (기본값)
  - 마감임박순
  - 인기순

**처리**
- `GET /api/campaigns` API 호출
  - 쿼리 파라미터로 필터 및 정렬 조건 전달
  - 예: `?category=food&region=seoul&status=recruiting&sort=latest`
- `campaigns` 테이블에서 데이터 조회:
  - `status = '모집중'` 인 체험단 우선 표시
  - 필터 조건에 따라 WHERE 절 적용
  - 정렬 조건에 따라 ORDER BY 절 적용
- 페이지네이션 처리 (20개씩)
- 각 체험단 카드에 다음 정보 포함:
  - 썸네일 이미지 (placeholder)
  - 제목
  - 모집 인원 (예: "5명 모집")
  - 마감일 (예: "D-7")
  - 모집 상태 뱃지

**출력**
- 성공 시:
  - 체험단 카드 그리드 뷰 표시
  - 각 카드 클릭 시 `/campaigns/:id` 페이지로 이동
- 데이터 없음:
  - "모집 중인 체험단이 없습니다" 빈 상태 메시지 표시
- 실패 시:
  - 네트워크 오류: "체험단 목록을 불러오는데 실패했습니다" 에러 메시지 표시
  - 재시도 버튼 표시

**사이드이펙트**
- React Query 캐시에 체험단 리스트 저장 (5분간 유지)

**엣지케이스**
- 모든 필터를 적용했으나 결과가 없는 경우
- 네트워크 느림으로 로딩이 길어지는 경우: 스켈레톤 UI 표시
- 무한 스크롤 중 데이터 끝에 도달한 경우

---

#### 1.2.2 체험단 상세 조회
**입력**
- 체험단 카드 클릭 또는 직접 URL 입력으로 `/campaigns/:id` 접근

**처리**
- `GET /api/campaigns/:id` API 호출
- `campaigns` 테이블에서 해당 ID의 상세 정보 조회
- 광고주 정보 조인 (`advertisers` 테이블)
- 현재 사용자 상태 확인:
  - 비로그인 사용자
  - 로그인했으나 인플루언서 정보 미등록
  - 인플루언서 정보 등록 완료
  - 이미 지원한 체험단인지 확인 (`applications` 테이블 조회)
- 모집 상태 확인 (`status` 필드)

**출력**
- 성공 시:
  - 체험단 정보 표시:
    - 제목, 설명, 제공 혜택
    - 모집 인원, 모집 기간
    - 매장 정보 (업체명, 주소, 연락처)
    - 미션 (요구사항)
  - CTA 버튼 상태:
    - 비로그인: "로그인 후 지원하기" 버튼 (클릭 시 `/login`으로 이동)
    - 인플루언서 정보 미등록: "프로필 등록 후 지원하기" 버튼 (클릭 시 `/onboarding/influencer`로 이동)
    - 인플루언서 정보 등록 완료 + 모집중 + 미지원: "지원하기" 버튼 활성화 (클릭 시 `/campaigns/:id/apply`로 이동)
    - 이미 지원한 경우: "지원 완료" 비활성화 버튼 표시
    - 모집 종료된 경우: "모집 종료" 비활성화 버튼 표시
- 실패 시:
  - 체험단이 존재하지 않음: "존재하지 않는 체험단입니다" 에러 페이지 표시
  - 네트워크 오류: "체험단 정보를 불러오는데 실패했습니다" 에러 메시지 표시

**엣지케이스**
- 존재하지 않는 체험단 ID로 접근
- 삭제된 체험단에 접근
- 광고주가 자신이 등록한 체험단 상세 페이지 접근: "지원하기" 버튼 숨김
- 모집 기간이 지났으나 상태가 `모집중`인 경우: "모집 종료" 상태로 자동 변경

---

#### 1.2.3 체험단 지원
**입력**
- `/campaigns/:id/apply` 페이지에서 지원서 작성
- 각오 한마디 (Textarea, 최대 500자)
- 방문 예정일자 (Date Picker, 현재 날짜 이후만 선택 가능)
- 제출 버튼 클릭

**처리**
- 접근 권한 확인:
  - 로그인 여부 확인
  - 인플루언서 정보 등록 여부 확인
  - 체험단 모집 상태 확인 (`status = '모집중'`)
  - 중복 지원 여부 확인 (`applications` 테이블 조회)
- 입력 데이터 유효성 검증:
  - 각오 한마디: 필수, 10자 이상 500자 이하
  - 방문 예정일: 필수, 오늘 이후 날짜
- Zod 스키마로 서버 사이드 검증
- `POST /api/applications` API 호출
- `applications` 테이블에 데이터 삽입:
  - `campaign_id`: 현재 체험단 ID
  - `influencer_id`: 현재 로그인한 인플루언서 ID
  - `message`: 각오 한마디
  - `visit_date`: 방문 예정일
  - `status`: '신청완료'
  - `applied_at`: 현재 시각

**출력**
- 성공 시:
  - "체험단 지원이 완료되었습니다" 성공 메시지 표시
  - `/my/applications` (내 지원 목록) 페이지로 리다이렉트
- 실패 시:
  - 권한 없음 (비로그인/정보 미등록): `/login` 또는 `/onboarding/influencer`로 리다이렉트
  - 중복 지원: "이미 지원한 체험단입니다" 에러 메시지 표시
  - 모집 종료: "모집이 종료된 체험단입니다" 에러 메시지 표시
  - 유효성 검증 실패: 각 필드별 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시 무효화 (내 지원 목록, 체험단 상세)
- 광고주의 신청자 리스트에 추가

**엣지케이스**
- 비로그인 상태에서 URL 직접 접근: `/login`으로 리다이렉트
- 인플루언서 정보 미등록 상태에서 접근: `/onboarding/influencer`로 리다이렉트
- 광고주 계정으로 지원 시도: "인플루언서만 지원할 수 있습니다" 에러 메시지 표시
- 지원서 작성 중 모집이 종료된 경우: 제출 시 "모집이 종료되었습니다" 에러 메시지 표시
- 이미 지원한 체험단 지원 페이지 재접근: "이미 지원한 체험단입니다" 메시지와 함께 `/my/applications`로 리다이렉트
- 방문 예정일에 과거 날짜 선택 시도

---

#### 1.2.4 내 지원 목록 조회
**입력**
- `/my/applications` 페이지 접근
- 선택적 필터 적용:
  - 상태 필터 (전체/신청완료/선정/반려)
- 선택적 정렬 변경:
  - 지원일 최신순 (기본값)
  - 지원일 오래된순

**처리**
- 접근 권한 확인:
  - 로그인 여부 확인
  - 인플루언서 역할 확인
- `GET /api/applications` API 호출
  - 쿼리 파라미터로 필터 및 정렬 조건 전달
  - 예: `?status=신청완료&sort=latest`
- `applications` 테이블에서 현재 사용자의 지원 내역 조회
- `campaigns` 테이블 조인하여 체험단 정보 포함
- 정렬 및 필터링 적용

**출력**
- 성공 시:
  - 지원 내역 테이블 뷰 표시:
    - 컬럼: 체험단명, 지원일, 상태, 방문 예정일
    - 상태별 뱃지: 신청완료(파란색), 선정(초록색), 반려(회색)
    - 각 행 클릭 시 해당 체험단 상세 페이지로 이동
- 데이터 없음:
  - "아직 지원한 체험단이 없습니다" 빈 상태 메시지 표시
  - "체험단 둘러보기" 버튼 표시 (클릭 시 홈으로 이동)
- 실패 시:
  - 권한 없음: `/login`으로 리다이렉트
  - 네트워크 오류: "지원 목록을 불러오는데 실패했습니다" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시에 지원 목록 저장 (5분간 유지)

**엣지케이스**
- 비로그인 상태에서 접근: `/login`으로 리다이렉트
- 광고주 계정으로 접근: "인플루언서 전용 페이지입니다" 에러 메시지 표시 후 홈으로 리다이렉트
- 상태 변경 알림: 선정/반려 상태로 변경된 지원서가 있는 경우 뱃지 표시

---

## 2. 광고주 유저 플로우

### 2.1 회원가입 및 온보딩

#### 2.1.1 회원가입 시작
(인플루언서와 동일하므로 1.1.1 참조)

---

#### 2.1.2 역할 선택
**입력**
- 회원가입 성공 후 자동으로 역할 선택 화면 표시
- 라디오 버튼으로 "광고주" 선택
- 다음 버튼 클릭

**처리**
- 선택한 역할 정보를 세션 또는 임시 상태에 저장
- 역할에 따른 리다이렉트 경로 결정

**출력**
- 광고주 선택 시: `/onboarding/advertiser` 페이지로 리다이렉트
- 선택하지 않은 경우: "역할을 선택해주세요" 에러 메시지 표시

**엣지케이스**
- 역할 미선택 상태에서 다음 버튼 클릭
- 브라우저 뒤로가기로 회원가입 페이지로 재진입 시도

---

#### 2.1.3 광고주 정보 등록
**입력**
- `/onboarding/advertiser` 페이지에서 폼 입력
- 공통 정보:
  - 이름 (텍스트)
  - 생년월일 (Date Picker)
  - 휴대폰번호 (텍스트, 숫자만)
- 광고주 정보:
  - 업체명 (텍스트)
  - 주소 (텍스트, 도로명 주소 API 연동 권장)
  - 업장 전화번호 (텍스트)
  - 사업자등록번호 (텍스트, XXX-XX-XXXXX 형식)
  - 대표자명 (텍스트)
- 제출 버튼 클릭

**처리**
- 입력 데이터 유효성 검증:
  - 이름: 필수, 2자 이상
  - 생년월일: 필수, 만 19세 이상
  - 휴대폰번호: 필수, 010-XXXX-XXXX 형식
  - 업체명: 필수
  - 주소: 필수
  - 업장 전화번호: 필수
  - 사업자등록번호: 필수, XXX-XX-XXXXX 형식
  - 대표자명: 필수
- Zod 스키마로 서버 사이드 검증
- `POST /api/advertisers` API 호출
- `advertisers` 테이블에 데이터 삽입:
  - `user_id`: 현재 로그인한 사용자 ID
  - `name`, `birth_date`, `phone`: 공통 정보
  - `business_name`, `address`, `business_phone`, `business_registration_number`, `representative_name`: 광고주 정보
  - `created_at`, `updated_at`: 자동 생성

**출력**
- 성공 시:
  - "광고주 정보가 등록되었습니다" 성공 메시지 표시
  - `/dashboard` (체험단 관리 대시보드)로 리다이렉트
- 실패 시:
  - 유효성 검증 실패: 각 필드별 에러 메시지 표시
  - 중복 등록 시도: "이미 등록된 정보가 있습니다" 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- 사용자 프로필 등록 완료 플래그 설정
- 체험단 관리 기능 활성화

**엣지케이스**
- 이미 광고주 정보가 등록된 사용자가 재접근 시도: 대시보드로 리다이렉트
- 필수 필드 미입력 상태에서 제출 시도
- 휴대폰번호/사업자등록번호 형식 오류
- 주소 API 연동 실패 시 수동 입력 허용
- 네트워크 연결 끊김 상태에서 제출

---

### 2.2 체험단 등록 및 관리

#### 2.2.1 체험단 관리 대시보드 조회
**입력**
- `/dashboard` 페이지 접근
- 선택적 필터 적용:
  - 모집 상태 (전체/모집중/모집종료/선정완료)
- 선택적 정렬 변경:
  - 생성일 최신순 (기본값)
  - 생성일 오래된순

**처리**
- 접근 권한 확인:
  - 로그인 여부 확인
  - 광고주 역할 확인
  - 광고주 정보 등록 여부 확인
- `GET /api/campaigns?advertiser_id={current_user_id}` API 호출
  - 현재 광고주가 등록한 체험단만 조회
  - 쿼리 파라미터로 필터 및 정렬 조건 전달
- `campaigns` 테이블에서 데이터 조회
- 각 체험단의 신청자 수 계산 (`applications` 테이블 카운트)

**출력**
- 성공 시:
  - 체험단 리스트 (카드 또는 테이블 뷰) 표시:
    - 컬럼: 체험단명, 모집 상태, 신청자 수, 모집 인원, 생성일
    - 상태별 뱃지: 모집중(파란색), 모집종료(노란색), 선정완료(초록색)
    - 각 행 클릭 시 `/dashboard/campaigns/:id` 페이지로 이동
  - "신규 체험단 등록" 버튼 표시 (우측 상단)
- 데이터 없음:
  - "등록된 체험단이 없습니다" 빈 상태 메시지 표시
  - "첫 체험단 등록하기" 버튼 표시
- 실패 시:
  - 권한 없음: `/login` 또는 `/onboarding/advertiser`로 리다이렉트
  - 네트워크 오류: "체험단 목록을 불러오는데 실패했습니다" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시에 체험단 리스트 저장 (5분간 유지)

**엣지케이스**
- 비로그인 상태에서 접근: `/login`으로 리다이렉트
- 광고주 정보 미등록 상태에서 접근: `/onboarding/advertiser`로 리다이렉트
- 인플루언서 계정으로 접근: "광고주 전용 페이지입니다" 에러 메시지 표시 후 홈으로 리다이렉트

---

#### 2.2.2 신규 체험단 등록
**입력**
- "신규 체험단 등록" 버튼 클릭
- Dialog 폼 오픈
- 필수 입력 항목:
  - 체험단명 (텍스트)
  - 설명 (Textarea)
  - 모집 시작일 (Date Picker)
  - 모집 종료일 (Date Picker)
  - 모집 인원 (숫자, 최소 1명)
  - 제공 혜택 (Textarea)
  - 미션/요구사항 (Textarea)
  - 매장 정보:
    - 업체명 (텍스트, 광고주 정보에서 자동 입력)
    - 주소 (텍스트, 광고주 정보에서 자동 입력 또는 수정 가능)
    - 연락처 (텍스트, 광고주 정보에서 자동 입력 또는 수정 가능)
  - 카테고리 (드롭다운: 음식점, 카페, 뷰티, 패션, 생활, 기타)
- 제출 버튼 클릭

**처리**
- 입력 데이터 유효성 검증:
  - 체험단명: 필수, 5자 이상 100자 이하
  - 설명: 필수, 20자 이상 2000자 이하
  - 모집 시작일: 필수, 오늘 이후 날짜
  - 모집 종료일: 필수, 모집 시작일 이후 날짜
  - 모집 인원: 필수, 1 이상
  - 제공 혜택: 필수
  - 미션: 필수
  - 매장 정보: 모두 필수
  - 카테고리: 필수
- Zod 스키마로 서버 사이드 검증
- `POST /api/campaigns` API 호출
- `campaigns` 테이블에 데이터 삽입:
  - `advertiser_id`: 현재 로그인한 광고주 ID
  - `title`, `description`, `recruitment_start_date`, `recruitment_end_date`, `recruitment_count`, `benefits`, `mission`, `store_name`, `store_address`, `store_phone`, `category`: 입력 데이터
  - `status`: '모집중'
  - `created_at`, `updated_at`: 자동 생성

**출력**
- 성공 시:
  - "체험단이 등록되었습니다" 성공 메시지 표시
  - Dialog 닫기
  - 체험단 리스트 자동 갱신 (React Query 캐시 무효화)
  - 새로 등록된 체험단이 리스트 상단에 표시
- 실패 시:
  - 유효성 검증 실패: 각 필드별 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시 무효화 (체험단 리스트)
- 홈 페이지의 체험단 리스트에 새 체험단 추가

**엣지케이스**
- 모집 종료일이 시작일보다 빠른 경우: "모집 종료일은 시작일 이후여야 합니다" 에러 메시지 표시
- 모집 인원 0 또는 음수 입력: "모집 인원은 1명 이상이어야 합니다" 에러 메시지 표시
- 네트워크 연결 끊김 상태에서 제출: 재시도 버튼 표시
- Dialog 닫기 시 작성 중인 데이터 손실: "작성 중인 내용이 있습니다. 정말 닫으시겠습니까?" 확인 모달 표시

---

#### 2.2.3 광고주용 체험단 상세 조회
**입력**
- 대시보드에서 체험단 카드/행 클릭
- `/dashboard/campaigns/:id` 페이지 접근

**처리**
- 접근 권한 확인:
  - 로그인 여부 확인
  - 광고주 역할 확인
  - 체험단 소유권 확인 (`campaigns.advertiser_id = current_user_id`)
- `GET /api/campaigns/:id` API 호출
- `campaigns` 테이블에서 해당 ID의 상세 정보 조회
- `GET /api/campaigns/:id/applications` API 호출
- `applications` 테이블에서 신청자 리스트 조회
- `influencers` 테이블 조인하여 인플루언서 정보 포함

**출력**
- 성공 시:
  - 체험단 정보 표시 (읽기 전용):
    - 제목, 설명, 제공 혜택, 모집 인원, 모집 기간, 매장 정보, 미션
  - 신청자 리스트 테이블:
    - 컬럼: 이름, SNS 채널명, 팔로워 수, 각오 한마디, 방문 예정일, 지원일
    - 정렬: 지원일 최신순 (기본값)
    - 각 행에 체크박스 (선정 시 사용)
  - 상태별 액션 버튼:
    - **모집중**: "모집 조기 종료" 버튼 표시
    - **모집종료**: "체험단 선정" 버튼 표시
    - **선정완료**: 버튼 숨김, "선정 완료" 뱃지 표시
- 실패 시:
  - 권한 없음 (다른 광고주의 체험단): "접근 권한이 없습니다" 에러 메시지 표시 후 대시보드로 리다이렉트
  - 체험단 없음: "존재하지 않는 체험단입니다" 에러 페이지 표시
  - 네트워크 오류: "체험단 정보를 불러오는데 실패했습니다" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시에 체험단 상세 및 신청자 리스트 저장

**엣지케이스**
- 비로그인 상태에서 접근: `/login`으로 리다이렉트
- 인플루언서 계정으로 접근: "광고주 전용 페이지입니다" 에러 메시지 표시 후 홈으로 리다이렉트
- 다른 광고주의 체험단 접근 시도: 권한 에러 표시
- 신청자가 없는 경우: "아직 지원한 인플루언서가 없습니다" 빈 상태 메시지 표시

---

### 2.3 인플루언서 선정

#### 2.3.1 모집 조기 종료
**입력**
- `/dashboard/campaigns/:id` 페이지에서 "모집 조기 종료" 버튼 클릭
- 확인 모달에서 "확인" 버튼 클릭

**처리**
- 확인 모달 표시: "모집을 조기 종료하시겠습니까? 종료 후에는 새로운 지원자를 받을 수 없습니다."
- 사용자가 "확인" 클릭 시:
  - `PATCH /api/campaigns/:id/status` API 호출
  - `campaigns` 테이블의 `status` 필드를 '모집종료'로 업데이트
  - 업데이트 시각(`updated_at`) 자동 갱신

**출력**
- 성공 시:
  - "모집이 조기 종료되었습니다" 성공 메시지 표시
  - 페이지 자동 갱신
  - 상태 뱃지가 "모집종료"로 변경
  - "모집 조기 종료" 버튼 숨김
  - "체험단 선정" 버튼 표시
- 실패 시:
  - 권한 없음: "접근 권한이 없습니다" 에러 메시지 표시
  - 이미 종료된 체험단: "이미 종료된 체험단입니다" 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시 무효화 (체험단 상세, 체험단 리스트)
- 홈 페이지의 체험단 리스트에서 "모집중" 필터에서 제외

**엣지케이스**
- 사용자가 확인 모달에서 "취소" 클릭 시: 아무 동작 없이 모달 닫기
- 이미 모집종료 또는 선정완료 상태인 경우: 버튼 숨김
- 네트워크 연결 끊김 상태에서 시도: 재시도 버튼 표시

---

#### 2.3.2 체험단 선정 프로세스
**입력**
- `/dashboard/campaigns/:id` 페이지에서 "체험단 선정" 버튼 클릭
- Dialog 오픈
- 신청자 리스트 (Checkbox 포함) 표시
- 선정할 인플루언서 체크박스 선택 (복수 선택 가능)
- 선정 인원 표시 (예: "5명 중 3명 선정")
- "선정 완료" 버튼 클릭

**처리**
- Dialog에서 신청자 리스트 표시:
  - 각 행에 체크박스 포함
  - 컬럼: 이름, SNS 채널명, 팔로워 수, 각오 한마디, 방문 예정일
- 선정 인원 제한 검증:
  - 선택한 인원이 모집 인원을 초과하는지 확인
  - 초과 시: "최대 N명까지 선정할 수 있습니다" 에러 메시지 표시
  - 0명 선택 시: "최소 1명 이상 선정해주세요" 에러 메시지 표시
- "선정 완료" 버튼 클릭 시:
  - `PATCH /api/applications/bulk` API 호출
  - 선정된 신청자의 `applications.status`를 '선정'으로 업데이트
  - 미선정 신청자의 `applications.status`를 '반려'로 업데이트
  - `campaigns` 테이블의 `status` 필드를 '선정완료'로 업데이트

**출력**
- 성공 시:
  - "인플루언서 선정이 완료되었습니다" 성공 메시지 표시
  - Dialog 닫기
  - 페이지 자동 갱신
  - 상태 뱃지가 "선정완료"로 변경
  - "체험단 선정" 버튼 숨김
  - 신청자 리스트에 선정/반려 상태 뱃지 표시
- 실패 시:
  - 선정 인원 초과: "최대 N명까지 선정할 수 있습니다" 에러 메시지 표시
  - 0명 선택: "최소 1명 이상 선정해주세요" 에러 메시지 표시
  - 권한 없음: "접근 권한이 없습니다" 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- React Query 캐시 무효화 (체험단 상세, 신청자 리스트, 체험단 리스트)
- 인플루언서의 "내 지원 목록"에서 상태 업데이트 (선정/반려)
- (추후 구현) 선정/반려 알림 발송

**엣지케이스**
- 모집 인원보다 많은 인원 선택 시: 체크박스 비활성화 또는 에러 메시지 표시
- 모집 인원보다 적은 인원 선택 시: 허용 (정상 동작)
- 0명 선택 후 제출 시도: "최소 1명 이상 선정해주세요" 에러 메시지 표시
- 선정 중 네트워크 연결 끊김: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시
- 이미 선정완료된 체험단: "이미 선정이 완료된 체험단입니다" 에러 메시지 표시
- 신청자가 없는 상태에서 선정 시도: "지원자가 없어 선정할 수 없습니다" 에러 메시지 표시

---

## 3. 공통 플로우

### 3.1 로그인

#### 3.1.1 로그인 프로세스
**입력**
- `/login` 페이지 접근
- 이메일 주소 입력
- 비밀번호 입력
- "로그인" 버튼 클릭

**처리**
- 이메일 형식 유효성 검증
- Supabase Auth를 통한 로그인 처리:
  - `supabase.auth.signInWithPassword()` 호출
  - 세션 생성 및 쿠키 설정
- 로그인 성공 시:
  - 사용자 역할 확인 (`advertisers` 또는 `influencers` 테이블 조회)
  - 프로필 등록 여부 확인
- 리다이렉트 경로 결정:
  - 인플루언서 정보 미등록: `/onboarding/influencer`
  - 광고주 정보 미등록: `/onboarding/advertiser`
  - 정보 등록 완료: `/` (홈 페이지)
  - 로그인 전 접근 시도한 페이지가 있는 경우: 해당 페이지로 리다이렉트

**출력**
- 성공 시:
  - 역할 및 프로필 등록 여부에 따라 적절한 페이지로 리다이렉트
  - 로그인 상태 유지 (세션 쿠키)
- 실패 시:
  - 이메일 또는 비밀번호 오류: "이메일 또는 비밀번호가 올바르지 않습니다" 에러 메시지 표시
  - 이메일 형식 오류: "올바른 이메일 형식을 입력해주세요" 에러 메시지 표시
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- 세션 쿠키 설정 (Supabase SSR)
- 전역 상태 업데이트 (Zustand)

**엣지케이스**
- 이미 로그인된 상태에서 `/login` 접근: 홈으로 리다이렉트
- 비밀번호 찾기 기능 (1차 범위 제외)
- 이메일 인증 미완료 (1차 범위에서는 자동 인증으로 가정)
- 계정 잠금 (1차 범위 제외)

---

### 3.2 로그아웃

#### 3.2.1 로그아웃 프로세스
**입력**
- 헤더/내비게이션에서 "로그아웃" 버튼 클릭

**처리**
- `supabase.auth.signOut()` 호출
- 세션 쿠키 삭제
- React Query 캐시 클리어
- 전역 상태 초기화 (Zustand)

**출력**
- 성공 시:
  - "로그아웃되었습니다" 성공 메시지 표시
  - `/login` 페이지로 리다이렉트
- 실패 시:
  - 네트워크 오류: "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지 표시

**사이드이펙트**
- 모든 클라이언트 상태 초기화
- 보호된 페이지 접근 시 로그인 페이지로 리다이렉트

**엣지케이스**
- 이미 로그아웃된 상태에서 로그아웃 시도: 정상 처리 (idempotent)

---

### 3.3 세션 관리

#### 3.3.1 세션 갱신
**입력**
- 사용자 페이지 이동 또는 새로고침

**처리**
- Middleware에서 `supabase.auth.getUser()` 호출
- 세션 유효성 확인
- 세션 만료 시:
  - Refresh Token으로 자동 갱신 시도
  - 갱신 실패 시: 로그아웃 처리

**출력**
- 세션 유효: 정상 페이지 표시
- 세션 만료 + 갱신 성공: 정상 페이지 표시
- 세션 만료 + 갱신 실패: `/login` 페이지로 리다이렉트

**사이드이펙트**
- 세션 쿠키 자동 갱신
- React Query 캐시 유지

**엣지케이스**
- 여러 탭에서 동시 로그인: 세션 동기화 (Supabase SSR 자동 처리)
- 장시간 비활성 후 활동: 세션 만료 시 로그인 페이지로 리다이렉트

---

#### 3.3.2 보호된 페이지 접근 제어
**입력**
- 비로그인 사용자가 보호된 페이지 접근 시도

**처리**
- Middleware에서 세션 확인
- 보호된 경로 목록:
  - `/onboarding/*`
  - `/dashboard`
  - `/dashboard/campaigns/*`
  - `/my/applications`
  - `/campaigns/:id/apply`
- 비로그인 시: 로그인 페이지로 리다이렉트
- 역할 불일치 시: 홈 페이지로 리다이렉트

**출력**
- 권한 있음: 정상 페이지 표시
- 권한 없음: 적절한 페이지로 리다이렉트
  - 비로그인: `/login?redirect={original_path}`
  - 역할 불일치: `/` (홈 페이지) + 에러 메시지 표시

**사이드이펙트**
- 리다이렉트 경로 저장 (로그인 후 원래 페이지로 복귀)

**엣지케이스**
- 인플루언서가 광고주 전용 페이지 접근
- 광고주가 인플루언서 전용 페이지 접근
- 프로필 미등록 상태에서 기능 페이지 접근

---

## 4. 에러 처리 및 엣지케이스

### 4.1 전역 에러 핸들링

#### 4.1.1 네트워크 오류
**처리**
- API 요청 실패 시 React Query의 retry 로직 활용 (최대 3회)
- 3회 실패 시 에러 메시지 표시
- 재시도 버튼 제공

**출력**
- "일시적인 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지
- "재시도" 버튼 표시

---

#### 4.1.2 서버 에러 (5xx)
**처리**
- Hono의 `errorBoundary()` 미들웨어에서 에러 로깅
- 사용자에게 일반적인 에러 메시지 표시
- 개발 환경에서는 상세 에러 스택 표시

**출력**
- "서버에서 오류가 발생했습니다. 잠시 후 다시 시도해주세요" 에러 메시지

---

#### 4.1.3 권한 에러 (403)
**처리**
- 권한이 없는 리소스 접근 시도 감지
- 적절한 페이지로 리다이렉트

**출력**
- "접근 권한이 없습니다" 에러 메시지
- 홈 페이지 또는 로그인 페이지로 리다이렉트

---

#### 4.1.4 Not Found 에러 (404)
**처리**
- 존재하지 않는 리소스 접근 시도 감지
- 404 에러 페이지 표시

**출력**
- "요청하신 페이지를 찾을 수 없습니다" 에러 페이지
- "홈으로 돌아가기" 버튼 표시

---

### 4.2 데이터 유효성 검증

#### 4.2.1 클라이언트 사이드 검증
**처리**
- React Hook Form과 Zod를 사용한 실시간 검증
- 필드별 에러 메시지 표시
- 제출 버튼 비활성화 (검증 실패 시)

**출력**
- 각 필드 하단에 빨간색 에러 메시지 표시
- 제출 버튼 비활성화 또는 활성화

---

#### 4.2.2 서버 사이드 검증
**처리**
- Zod 스키마로 요청 데이터 검증
- 검증 실패 시 400 Bad Request 응답
- 상세한 에러 정보 반환

**출력**
- 필드별 에러 메시지 객체 반환
- 클라이언트에서 해당 필드에 에러 메시지 표시

---

### 4.3 동시성 제어

#### 4.3.1 중복 제출 방지
**처리**
- 제출 버튼 클릭 시 즉시 비활성화
- 로딩 스피너 표시
- 응답 완료 후 버튼 재활성화

**출력**
- 로딩 중: "처리 중..." 메시지와 스피너 표시
- 완료 후: 성공/실패 메시지 표시

---

#### 4.3.2 낙관적 업데이트
**처리**
- React Query의 optimistic update 활용
- UI 즉시 업데이트 후 서버 동기화
- 실패 시 롤백

**출력**
- 즉각적인 UI 피드백
- 실패 시 원래 상태로 복구 + 에러 메시지 표시

---

## 5. UX 개선 사항

### 5.1 로딩 상태

#### 5.1.1 스켈레톤 UI
**처리**
- 데이터 로딩 중 스켈레톤 UI 표시
- 실제 컨텐츠 레이아웃과 유사한 형태

**출력**
- 회색 애니메이션 블록으로 로딩 표시

---

#### 5.1.2 프로그레스 인디케이터
**처리**
- 긴 작업(파일 업로드 등) 진행률 표시
- 백분율 또는 단계별 표시

**출력**
- 프로그레스 바 또는 스텝 인디케이터

---

### 5.2 피드백

#### 5.2.1 토스트 메시지
**처리**
- 성공/실패 액션 후 토스트 메시지 표시
- 3초 후 자동 사라짐

**출력**
- 화면 상단 또는 하단에 토스트 메시지 표시

---

#### 5.2.2 확인 모달
**처리**
- 중요한 액션(삭제, 종료 등) 전 확인 요청
- "확인"/"취소" 버튼 제공

**출력**
- 중앙 모달로 확인 메시지 표시

---

### 5.3 빈 상태

#### 5.3.1 데이터 없음
**처리**
- 리스트가 비어있을 때 적절한 빈 상태 메시지 표시
- 액션 버튼 제공 (예: "첫 체험단 등록하기")

**출력**
- 일러스트 + 메시지 + CTA 버튼

---

## 6. 접근성

### 6.1 키보드 내비게이션
**처리**
- Tab 키로 포커스 이동
- Enter/Space 키로 버튼 클릭
- Esc 키로 모달 닫기

**출력**
- 포커스 표시 (outline)
- 키보드만으로 모든 기능 사용 가능

---

### 6.2 스크린 리더
**처리**
- 모든 이미지에 alt 텍스트
- ARIA 레이블 적용
- 시맨틱 HTML 사용

**출력**
- 스크린 리더 호환

---

## 7. 성능 최적화

### 7.1 코드 스플리팅
**처리**
- Next.js 동적 import 활용
- 라우트별 코드 분리

**출력**
- 초기 로딩 시간 단축

---

### 7.2 이미지 최적화
**처리**
- Next.js Image 컴포넌트 사용
- Lazy loading 적용

**출력**
- 빠른 이미지 로딩
- 대역폭 절약

---

### 7.3 캐싱
**처리**
- React Query로 서버 상태 캐싱
- 5분 stale time 설정

**출력**
- 불필요한 API 요청 감소
- 빠른 페이지 전환

---

## 8. 보안

### 8.1 XSS 방지
**처리**
- React의 자동 이스케이핑 활용
- dangerouslySetInnerHTML 사용 금지

**출력**
- 안전한 사용자 입력 처리

---

### 8.2 CSRF 방지
**처리**
- Supabase의 CSRF 토큰 자동 처리
- SameSite 쿠키 설정

**출력**
- CSRF 공격 방어

---

### 8.3 SQL Injection 방지
**처리**
- Supabase의 Parameterized Query 사용
- 직접 SQL 작성 금지

**출력**
- 안전한 데이터베이스 쿼리

---

## 9. 모니터링 및 로깅

### 9.1 에러 로깅
**처리**
- Hono의 `errorBoundary()` 미들웨어에서 에러 로깅
- 콘솔 로그 출력 (개발 환경)

**출력**
- 에러 발생 시 로그 기록

---

### 9.2 사용자 행동 추적
**처리**
- (추후 구현) Google Analytics 또는 Mixpanel 연동
- 주요 액션 이벤트 트래킹

**출력**
- 사용자 행동 데이터 수집

---

## 10. 요약

본 Userflow 문서는 블로그 체험단 리뷰 시스템의 모든 사용자 플로우를 상세히 정의합니다. 각 플로우는 입력, 처리, 출력으로 구성되며, 발생 가능한 엣지케이스와 에러 상황을 모두 고려하여 작성되었습니다.

### 핵심 플로우
1. **인플루언서**: 회원가입 → 정보 등록 → 체험단 탐색 → 지원 → 내 지원 목록 확인
2. **광고주**: 회원가입 → 정보 등록 → 체험단 등록 → 신청자 관리 → 인플루언서 선정

### 주요 원칙
- 모든 사용자 입력은 클라이언트/서버 양쪽에서 검증
- 권한 기반 접근 제어 적용
- 명확한 에러 메시지 제공
- 사용자 경험을 최우선으로 고려
- 보안과 성능을 균형있게 유지
